(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{170:function(t,e,n){},218:function(t,e){},357:function(t,e){},360:function(t,e){},364:function(t,e){},365:function(t,e){},366:function(t,e){},367:function(t,e){},368:function(t,e){},456:function(t,e,n){"use strict";n.r(e);var o=n(166),i=n(51),r=(n(170),n(14),n(159)),a=n(25),c=n(94),s=n(3),u=n(459),l=n(460);function d(t){return Object(s.q)((function(e){return{type:"SPEAK",value:t}}))}Object(s.q)((function(t){return{type:"SPEAK",value:"Do you want to create a meeting titled ".concat(t.title," on ").concat(t.day)}}));var f={initial:"idle",states:{idle:{on:{CLICK:"init"}},init:{on:{TTS_READY:"openning",CLICK:"openning"}},openning:{initial:"prompt",entry:function(t){return t.counter=0},on:{RECOGNISED:[{target:"welcome",actions:Object(s.b)({userName:function(t){return t.recResult[0].utterance}})},{target:".nomatch"}],TIMEOUT:".prompt"},states:{prompt:{entry:d("Tell me your name please."),on:{ENDSPEECH:"ask"}},ask:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Tell me something I know."),on:{ENDSPEECH:"ask"}}}},welcome:{initial:"prompt",entry:function(t){return t.counter=0},on:{RECOGNISED:[{target:"intentSwitch"},{target:".nomatch"}],TIMEOUT:[{target:".prompt",cond:function(t){return t.counter%3!==0}},{target:".botServices",cond:function(t){return t.counter%3===0}}]},states:{prompt:{entry:[Object(s.q)((function(t){return{type:"SPEAK",value:"Hi ".concat(t.userName,". What can I do for you? ")}})),function(t){return t.counter+1}],on:{ENDSPEECH:"ask"}},botServices:{entry:d("Here is a list of what I can do: vacuum, dump trash, turn on light, or turn off light."),on:{ENDSPEECH:"prompt"}},ask:{entry:Object(s.q)("LISTEN")},nomatch:{entry:d("Sorry, I don't know what it is. Tell me something I know."),on:{ENDSPEECH:"ask"}}}},intentSwitch:{id:"intentSwitch",initial:"prompt",states:{prompt:{entry:d("Let me check the inventory."),on:{ENDSPEECH:"getIntentRasa"}},getIntentRasa:{id:"getIntentRasa",invoke:{src:function(t){return e=t.recResult[0].utterance,fetch(new Request("https://rasa-nlu-yw.herokuapp.com/model/parse",{method:"POST",body:'{"text": "'.concat(e,'"}')})).then((function(t){return t.json()}));var e},onDone:{target:"success",actions:Object(s.b)({intent:function(t,e){return e.data.intent.name}})},onError:{target:"fail",actions:function(t,e){return console.log(t,e)}}}},success:{always:[{target:"#root.dm.vacuum",cond:function(t){return"vacuum"===t.intent}},{target:"#root.dm.dump_trash",cond:function(t){return"move_to_trash"===t.intent}},{target:"#root.dm.turn_on_light",cond:function(t){return"turn_on_light"===t.intent}},{target:"#root.dm.turn_off_light",cond:function(t){return"turn_off_light"===t.intent}}]},fail:{},hist:{type:"history",history:"deep"}}},vacuum:{initial:"prompt",on:{},states:{prompt:{entry:d("OK, start vacuuming"),on:{ENDSPEECH:"jobFinished"}},jobFinished:{entry:d("I am vacuuming and it will be fone in 1 second."),after:{1e3:{target:"#root.dm.welcome"}}}}},dump_trash:{initial:"prompt",on:{},states:{prompt:{entry:d("OK, start dumpping the trash"),on:{ENDSPEECH:"jobFinished"}},jobFinished:{entry:d("The trash is dumpped."),after:{500:{target:"#root.dm.welcome"}}}}},turn_on_light:{initial:"prompt",on:{},states:{prompt:{entry:d("OK, trun on the light."),on:{ENDSPEECH:"jobFinished"}},jobFinished:{entry:d("Now the light is on."),after:{500:{target:"#root.dm.welcome"}}}}},turn_off_light:{initial:"prompt",on:{},states:{prompt:{entry:d("OK, turn off the light"),on:{ENDSPEECH:"jobFinished"}},jobFinished:{entry:d("Now the light is off."),after:{500:{target:"#root.dm.welcome"}}}}},info:{entry:Object(s.q)((function(t){return{type:"SPEAK",value:"OK, ".concat(t.title)}})),on:{ENDSPEECH:"init"}}}},p=n(160),m=n.n(p),E=n(163),S=n.n(E),h=n(12),g=a.a.send,b=a.a.cancel,T="northeurope";Object(l.a)({url:"https://statecharts.io/inspect",iframe:!1});var O=Object(c.a)({id:"root",type:"parallel",states:{dm:Object(i.a)({},f),asrtts:{initial:"init",states:{init:{on:{CLICK:{target:"getToken",actions:[Object(s.b)({audioCtx:function(t){return new(window.AudioContext||window.webkitAudioContext)}}),function(t){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioCtx.createMediaStreamSource(e)}))}]}}},getToken:{invoke:{id:"getAuthorizationToken",src:function(t,e){return _()},onDone:{actions:[Object(s.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillASR"],target:"ponyfillTTS"},onError:{target:"fail"}}},ponyfillTTS:{invoke:{id:"ponyTTS",src:function(t,e){return function(e,n){var o=S()({audioContext:t.audioCtx,credentials:{region:T,authorizationToken:t.azureAuthorizationToken}}),i=o.speechSynthesis,r=o.SpeechSynthesisUtterance;t.tts=i,t.ttsUtterance=r,t.tts.addEventListener("voiceschanged",(function(){t.tts.cancel();var n=t.tts.getVoices(),o=RegExp("en-US","u");o=RegExp("en-US","u");var i=n.find((function(t){return o.test(t.name)}));i?(t.voice=i,e("TTS_READY")):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(o)),e("TTS_ERROR"))}))}}},on:{TTS_READY:"idle",TTS_ERROR:"fail"}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(s.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(s.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",SELECT:"idle",CLICK:".pause",RECSTOP:"idle"},states:{noinput:{entry:["recStart",g({type:"TIMEOUT"},{delay:function(t){return 1e3*(t.tdmPassivity||3)},id:"timeout"})],on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:b("timeout")},inprogress:{},match:{entry:g("RECOGNISED")},pause:{entry:"recStop",on:{CLICK:"noinput"}}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle",SELECT:"idle",CLICK:{target:"idle",actions:g("ENDSPEECH")}},exit:"ttsStop"},fail:{}}}}},{actions:{recLogResult:function(t){console.log("U>",t.recResult[0].utterance,t.recResult[0].confidence)},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),v=function(t){var e=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,n=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"image"===t.attribute}))||{}).value,o="circle";switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):break;case t.state.matches({asrtts:{recognising:"pause"}}):e="Click to continue";break;case t.state.matches({asrtts:"recognising"}):o="circle-recognising",e=e||"Listening...";break;case t.state.matches({asrtts:"speaking"}):o="circle-speaking",e=e||"Speaking...";break;case t.state.matches({dm:"idle"}):case t.state.matches({dm:"init"}):e="Click to start!",o="circle-click";break;default:e=e||"\xa0"}return Object(h.jsxs)("div",{className:"control",children:[Object(h.jsx)("figure",{className:"prompt",children:n&&Object(h.jsx)("img",{src:n,alt:e})}),Object(h.jsxs)("div",{className:"status",children:[Object(h.jsx)("button",Object(i.a)({type:"button",className:o,style:{}},t)),Object(h.jsx)("div",{className:"status-text",children:e})]})]})},C=function(t){var e=t.alternative.find((function(t){return"name"===t.attribute})).value,n=(t.alternative.find((function(t){return"image"===t.attribute}))||{}).value;return Object(h.jsxs)("figure",Object(i.a)(Object(i.a)({className:"flex"},t),{},{children:[n&&Object(h.jsx)("img",{src:n,alt:e}),Object(h.jsx)("figcaption",{children:e})]}))};function j(){var t=Object(u.b)(O,{devTools:!0,actions:{changeColour:Object(u.a)((function(t){document.body.style.background=t.recResult[0].utterance})),recStart:Object(u.a)((function(t){t.asr.start()})),recStop:Object(u.a)((function(t){t.asr.abort()})),ttsStart:Object(u.a)((function(t){var e='<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="http://www.w3.org/2001/mstts" xml:lang="en-US"><voice name="'.concat(t.voice.name,'">');e+=Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate-lt2216",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUBSCRIPTION_KEY:"87b7cdf6f3b748699fd030efd3a2da73",REACT_APP_ASR_LANGUAGE:"en-US",REACT_APP_TTS_VOICE:"en-US"}).REACT_APP_TTS_LEXICON?'<lexicon uri="'.concat(Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate-lt2216",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUBSCRIPTION_KEY:"87b7cdf6f3b748699fd030efd3a2da73",REACT_APP_ASR_LANGUAGE:"en-US",REACT_APP_TTS_VOICE:"en-US"}).REACT_APP_TTS_LEXICON,'"/>'):"",e+="".concat(t.ttsAgenda,"</voice></speak>"),console.debug(e);var n=new t.ttsUtterance(e);console.log("S>",t.ttsAgenda),n.voice=t.voice,n.onend=function(){return i("ENDSPEECH")},t.tts.speak(n)})),ttsStop:Object(u.a)((function(t){t.tts.cancel()})),ponyfillASR:Object(u.a)((function(t,e){var n=m()({audioContext:t.audioCtx,credentials:{region:T,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;t.asr=new n,t.asr.lang="en-US",t.asr.continuous=!0,t.asr.interimResults=!0,t.asr.onresult=function(t){var e=t.results[0];e.isFinal?i({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):i({type:"STARTSPEECH"})}}))}}),e=Object(o.a)(t,2),n=e[0],i=e[1],r=(n.context.tdmExpectedAlternatives||[]).filter((function(t){return t.visual_information})).map((function(t,e){return Object(h.jsx)(C,{state:n,alternative:t.visual_information,onClick:function(){return i({type:"SELECT",value:t.semantic_expression})}},e)}));return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)(v,{state:n,alternative:{},onClick:function(){return i("CLICK")}}),Object(h.jsx)("div",{className:"select-wrapper",children:Object(h.jsx)("div",{className:"select",children:r})})]})}var _=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"87b7cdf6f3b748699fd030efd3a2da73"}})).then((function(t){return t.text()}))},R=document.getElementById("root");r.render(Object(h.jsx)(j,{}),R)}},[[456,1,2]]]);
//# sourceMappingURL=main.851fef95.chunk.js.map